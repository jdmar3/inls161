<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script type="text/javascript">
    var host = "inls161.johndmart.in";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script>
  
    
  
  <title>Tools for Information Literacy&nbsp;|&nbsp;Databases, tables, queries, and relationships</title>
  <meta name="description" content="Today we will continue with our discussion of databases and then learn ALL THE SQL. ">

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
  
  <!-- Load Moment.js for dates if option set in /_data/optins.yml file-->
   
     <script type="text/javascript" src="//momentjs.com/downloads/moment.js"></script> 
    
   
  
     <script type="text/javascript" src="//storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/datejs/date.js"></script>
  
  
<link rel="stylesheet" href="/css/tufte.css"> 

  
  
<link rel="/apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
<link rel="manifest" href="/assets/img/manifest.json">
<link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link rel="canonical" href="/class/2017/07/21/database-tables-queries/">

<link rel="alternate" type="application/rss+xml" title="Tools for Information Literacy" href="/feed.xml" />


    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <!-- CSS-->
    <link rel="stylesheet" href="/css/timeline.css">
    <!--FONT-->
    <link rel="stylesheet" href="/css/fonts/font.tufte.css">

    <!-- HTML5 shim, for IE6-8 support of HTML elements-->
    <!--if lt IE 9
    script(src='https://html5shim.googlecode.com/svn/trunk/html5.js')
    
    -->


</head>

  <body>
    <div class="wrap">
    <!--- Header and nav template site-wide -->
<header>
    <nav class="group">
	<a href="/"><img class="badge" src="/assets/img/161icon.png" alt="UNC"></a>
	
	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
  	
		
		    
		      <a href="/">Tools for Information Literacy</a>
		    
	    
  	
		
  	
		
		    
		      <a href="/syllabus/">Syllabus</a>
		    
	    
  	
		
		    
		      <a href="/schedule/">Schedule</a>
		    
	    
  	
		
  	
		
  	
		
		    
		      <a href="/quiz/">Quiz</a>
		    
	    
  	
		
		    
		      <a href="/assignments/">Assignments</a>
		    
	    
  	
		
		    
		      <a href="/refsheets/">Reference</a>
		    
	    
  	
	</nav>

</header>
    <article class="group">
      <h1>Databases, tables, queries, and relationships</h1>



<p class="subtitle"><span id="date">Friday, 21 July 2017</span><span class="smaller date contrast"></span></p>

<script>
var date = document.getElementById("span")[0];
alert(p.childNodes[1].textContent)
</script>

<p>Today we will continue with our discussion of databases and then learn ALL THE SQL. </p>

<p><img src="/assets/img/learnallthesql.jpg" alt="LEARN ALL THE SQL">
<excerpt/></p>

<h2 id="define-relationships">Define relationships</h2>

<p>We need to tell MySQL that the PubID column in tblBook refers to the primary key in tblPub. This action is called a constraint and the reference is called a foreign key. </p>

<p><code>ALTER TABLE tblBook ADD CONSTRAINT fk_PubID FOREIGN KEY (PubID) REFERENCES tblPub(ID) ON UPDATE NO ACTION;</code></p>

<p>Let&#39;s look at our columns again:</p>

<p><code>SHOW COLUMNS FROM tblBook;</code></p>

<p>You&#39;ll notice that the &#39;Key&#39; column now has &#39;MUL&#39; for PubID. 
This means that we are using that column as an index as well as the primary key column. 
This new index just happens to be non-unique. </p>

<h1 id="summaries">Summaries</h1>

<p>So now that we have our data in place, let&#39;s summarize it a bit. </p>

<p><code>SELECT COUNT(*) FROM tblBook;</code></p>

<p>What if we want to see the first ten rows in tblBook?</p>

<p><code>SELECT * FROM tblBook ORDER BY Date LIMIT 10;</code></p>

<p>Let&#39;s look at only books published after 1980;</p>

<p><code>SELECT * FROM tblBook WHERE Date &gt; 1980 ORDER BY Date;</code></p>

<p>And count them:</p>

<p><code>SELECT COUNT(*) FROM tblBook WHERE Date &gt; 1980 ORDER BY Date;</code></p>

<p>How about only books published in 1980?</p>

<p><code>SELECT * FROM tblBook WHERE Date = 1980 ORDER BY ShelfNumber;</code></p>

<p>Let&#39;s find out how much our books cost:</p>

<p><code>SELECT AVG(RetailPrice) FROM tblBook;</code></p>

<p><code>SELECT MIN(RetailPrice) FROM tblBook;</code></p>

<p><code>SELECT MAX(RetailPrice) FROM tblBook;</code></p>

<p>Let&#39;s summarize all of that together.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> 
<span class="k">AVG</span><span class="p">(</span><span class="n">RetailPrice</span><span class="p">)</span> <span class="k">AS</span> <span class="s1">'Average Price'</span><span class="p">,</span>
<span class="k">MIN</span><span class="p">(</span><span class="n">RetailPrice</span><span class="p">)</span> <span class="k">AS</span> <span class="s1">'Lowest Price'</span><span class="p">,</span>
<span class="k">MAX</span><span class="p">(</span><span class="n">RetailPrice</span><span class="p">)</span> <span class="k">AS</span> <span class="s1">'Highest Price'</span>
<span class="k">FROM</span> <span class="n">tblBook</span><span class="p">;</span>
</code></pre></div>
<h2 id="make-queries-using-joins">Make queries using joins</h2>

<p>Joins in SQL logic merge two different but related tables together so that the data can be queries across them.<label for='sqljoins' class='margin-toggle sidenote-number'></label><input type='checkbox' id='sqljoins' class='margin-toggle'/><span class='sidenote'>&quot;A Visual Explanation of SQL Joins,&quot; Coding Horror, 11 October 2007 <a href="https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/">https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/</a> </span> 
Joins seem complex to think about, but they are really very simple. 
They make sets of data based on conditions.
For our practice data, which deals with book lists, we might want to find books published by certain publishers, which is contained in a different table. </p>

<p>Here are some examples. </p>

<p>I want to list out all the books in the list that were published by Oxford University Press. </p>

<p><code>SELECT * FROM tblBook b RIGHT JOIN tblPub p ON b.PubID = p.ID WHERE p.Publisher = &#39;Oxford University Press&#39;;</code></p>

<p>How many locations does OUP have? </p>

<p><code>SELECT COUNT(*) FROM tblPub WHERE Publisher = &#39;Oxford University Press&#39;;</code></p>

<p>Where are they?</p>

<p><code>SELECT * FROM tblPub WHERE Publisher = &#39;Oxford University Press&#39;;</code></p>

<p>What if I only want the books published by OUP&#39;s US office? 
I have to specify an additional criterion. </p>

<p><code>SELECT * FROM tblBook b RIGHT JOIN tblPub p ON b.PubID = p.ID WHERE p.Publisher = &#39;Oxford University Press&#39; AND p.Country = &#39;US&#39;;</code></p>

<p>I wonder if books cost more from the OUP GB location than from the OUP US location.</p>

<p><code>SELECT AVG(RetailPrice) FROM tblBook b RIGHT JOIN tblPub p ON b.PubID = p.ID WHERE p.Publisher = &#39;Oxford University Press&#39; AND p.Country = &#39;GB&#39;;</code></p>

<p><code>SELECT AVG(RetailPrice) FROM tblBook b RIGHT JOIN tblPub p ON b.PubID = p.ID WHERE p.Publisher = &#39;Oxford University Press&#39; AND p.Country = &#39;US&#39;;</code></p>

<h1 id="output-from-mysql-queries-as-views">Output from MySQL queries as views</h1>

<p>We can take any of the above queries and output the results to a virtual table called a <em>view</em>. 
Views let you create and drop tables on the fly without as much risk of accidentally dropping a real table from your database. </p>

<p>We need to add <code>CREATE VIEW qryName AS</code> to the front of any of our query commands. </p>

<p>Here is an example using our price summary from above:</p>

<p><code>CREATE VIEW qryPrices AS SELECT AVG(RetailPrice) AS &#39;Average Price&#39;, MIN(RetailPrice) AS &#39;Lowest Price&#39;, MAX(RetailPrice) AS &#39;Highest Price&#39; FROM tblBook;</code></p>

<p>See if it worked by listing the tables:</p>

<p><code>show tables;</code></p>

<p>Look at what is in the new table:</p>

<p><code>SELECT * FROM qryPrices</code></p>

<p>It should match the output from when you ran the query before. </p>

<p>Try to writes some other views to tables </p>

<h2 id="output-from-mysql-queries-in-other-formats">Output from MySQL queries in other formats</h2>

<p>We can output all of this stuff outside of our MySQL prompt shell (in a normal shell).</p>

<p>Let&#39;s ask for the summary of book prices in HTML and then we can try some other queries if we have time. </p>

<p><code>quit</code> to exit the MySQL prompt.</p>

<p>Now you have exited from the MySql prompt.</p>

<p><code>mysql -u root -p -H -e &quot;SELECT AVG(RetailPrice) AS &#39;Average Price&#39;, MIN(RetailPrice) AS &#39;Lowest Price&#39;, MAX(RetailPrice) AS &#39;Highest Price&#39; FROM tblBook;&quot; booksinfo</code></p>

<h1 id="exporting-and-importing">Exporting and Importing</h1>

<p>To export your whole database so that you can use it elsewhere (i.e., transfer it to a different server) do the following command:</p>

<p><code>mysqldump -u root -p booksinfo &gt; booksinfo.sql</code></p>

<p>If you want to then import that same database somewhere else, the command is very similar. The direction changes, and instead of the specialized <code>mysqldump</code> command, you use just the standard MySQL client command:</p>

<p><code>mysql -u root -p booksinfo &lt; booksinfo.sql</code></p>

<h1 id="mysql-in-bash-scripts">MySQL in Bash scripts</h1>

<p>I would suggest looking at the the manual page for the MySQL client to see what you can do on the command line.<label for='mysql-man' class='margin-toggle sidenote-number'></label><input type='checkbox' id='mysql-man' class='margin-toggle'/><span class='sidenote'>“mysql(1): MySQL Tool.” Linux Man Page. Accessed July 15, 2016. <a href="http://linux.die.net/man/1/mysql">http://linux.die.net/man/1/mysql</a>. </span></p>

<p>You will be expected in class to be looking up other resources as well. 
If you find something useful, share it with me and I will put links here.</p>

<p>To execute MySQL commands from within BASH (i.e., not logging into MySQL first), you have to use the <code>-e</code> switch for &quot;execute,&quot; like this:</p>

<p><code>mysqldump -u root -p &quot;SHOW DATABASES&quot;</code></p>

<p>This will still prompt you for your password. If you want to add the password into the command, you can do it in one of the two following ways:</p>

<p><code>mysqldump -u root -p&quot;root&quot; &quot;SHOW DATABASES&quot;</code></p>

<p><code>mysqldump -u root --password=&quot;root&quot; &quot;SHOW DATABASES&quot;</code></p>

<p>This will allow you to set the username and password as variables in your scripts and then run commands to work with data inside a database from the script: </p>
<div class="highlight"><pre><code class="language-" data-lang="">#1/bin/bash
# set MySQL credentials
SQLUSER=root
SQLPASS=root
# show all databases 
mysqldump -u SQLUSER --password="$SQLPASS" "SHOW DATABASES"
</code></pre></div>
<h1 id="for-next-time">For Next Time</h1>

<p>Next time we are going to begin talking about presentations and creating good presentation materials. </p>

<p>I would like you to read/deep skim Edward Tufte&#39;s piece on the stupidity of PowerPoint.<label for='powerpoint' class='margin-toggle sidenote-number'></label><input type='checkbox' id='powerpoint' class='margin-toggle'/><span class='sidenote'>Tufte, Edward R. The Cognitive Style of Powerpoint: Pitching Out Corrupts Within. Cheshire, Connecticut: Graphics Press, 2011. <a href="https://paperpile.com/shared/gQqL5P">https://paperpile.com/shared/gQqL5P</a>. </span> </p>

<h2 id="exemplars">Exemplars</h2>

<p>I would also like you to view the following video of a talk by Lawrence Lessig.
We will look at parts of this in class as well, but it would be good if you could sit down and view the whole thing over the course of the weekend.
It exists in four parts linked below.</p>

<div class="video-container">
  <iframe width="420" height="315" src="https://www.youtube.com/embed/Qk_5UccWm3o" frameborder="0" allowfullscreen></iframe>
</div>

<div class="video-container">
  <iframe width="420" height="315" src="https://www.youtube.com/embed/piLXKUE_Bzo" frameborder="0" allowfullscreen></iframe>
</div>

<div class="video-container">
  <iframe width="420" height="315" src="https://www.youtube.com/embed/ajv0Lxaqoys" frameborder="0" allowfullscreen></iframe>
</div>

<div class="video-container">
<iframe width="420" height="315" src="https://www.youtube.com/embed/xSbWG2LFrOk" frameborder="0" allowfullscreen></iframe>
</div>

<h2 id="reveal-js">Reveal.js</h2>

<p>We will be using reveal.js to create presentations. 
Please click through this demo presentation and see what is possible to do with it.<label for='reveal' class='margin-toggle sidenote-number'></label><input type='checkbox' id='reveal' class='margin-toggle'/><span class='sidenote'>El Hattab, Hakim. Reveal.js: The HTML5 Presentation Framework. <a href="http://lab.hakim.se/reveal-js/#/">http://lab.hakim.se/reveal-js/#/</a>. </span> 
You can also view the source code for the demo presentation. 
We will look at this together in detail. </p>

<h2 id="thought-leaders-and-ted-talks">Thought leaders and TED Talks</h2>

<p>You should also give the following video a watch.
It will help put into perspective what is really happening when we watch TED Talks and similar presentations. 
Also, it is amusing.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/_ZBKX-6Gz6A" frameborder="0" allowfullscreen></iframe>
</div>


<p>
  <br/>
  <ul class="tags">
    <li><a href="/topics#database" class="tag">database</a></li><li><a href="/topics#tables" class="tag">tables</a></li><li><a href="/topics#queries" class="tag">queries</a></li><li><a href="/topics#SQL" class="tag">SQL</a></li><li><a href="/topics#MySQL" class="tag">MySQL</a></li>
  </ul> 
</p>
    </article>
    <span class="print-footer">Databases, tables, queries, and relationships - July 21, 2017 - </span>
    <footer>
  <div class="larger blognav">
    
      <a class="prev" href="/class/2017/07/20/sql-bootcamp/">&laquo;&nbsp;<span class="smaller">Previous:</span>&nbsp;Database software and MySQL</a>
    
    
      <a class="next" href="/assignments/2017/07/23/assignment-4-data/"><span class="smaller">Next:</span>&nbsp;Assignment #4: Collect Data and Make a Database&nbsp;&raquo;</a>
    
  </div>
  <hr class="slender">
  <ul class="footer-links">
    
    
      <li>
        <a href="http://johndmart.in" title="Instructor home page"><span class="ico-user"></span>&nbsp;John D. Martin III</a>
      </li>
    
    
      <li>
        <a href="mailto:john.d.martin.iii@unc.edu" title="Email instructor"><span class="ico-envelope"></span>&nbsp;john.d.martin.iii@unc.edu</a>
      </li>
    
    
      <li>
        <span class="ico-clock"></span>&nbsp;11:30-13:00
      </li>
    
    
      <li>
        <span class="ico-calendar"></span>&nbsp;MoTuWeThFr
      </li>
    
    
      <li>
        <span class="ico-library"></span>&nbsp;117 Manning Hall
      </li>
    
    
      <li>
        <a href="https://github.com/inls161" title="GitHub organization for this course"><span class="ico-github"></span></a>
      </li>
    
    
      <li>
        <a href="https://inls161.slack.com" title="Join the Slack conversations for this course"><span class="ico-slack"></span></a>
      </li>
    
    
      <li>
        <a href="/feed" title="Add RSS feed"><span class="ico-rss"></span></a>
      </li>
      
  </ul>
<div class="credits">
  <span>TOOLS FOR INFORMATION LITERACY &nbsp;&nbsp;|&nbsp;&nbsp; INLS161-001 (Summer II)
    <br/> 
  <span class="smaller">Tools and concepts for information literacy. Includes software use and maintenance, computer applications, and networked information systems.</span>
  <br/><br/>
  <span class="smaller">All content licensed under a <a target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</span>
  <br/>
  <span class="smaller"><a href="credits/">Content &copy; 2017 John D. Martin III</a></span>
</div>  
</footer>
    </div>
  </body>
</html>
